[21:54:05 Information] 
Starting host...

[21:54:05 Warning] Microsoft.AspNetCore.DataProtection.Repositories.FileSystemXmlRepository
Storing keys in a directory '/root/.aspnet/DataProtection-Keys' that may not be persisted outside of the container. Protected data will be unavailable when container is destroyed.

[21:54:05 Information] Microsoft.AspNetCore.DataProtection.KeyManagement.XmlKeyManager
User profile is available. Using '/root/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.

[21:54:07 Debug] 
alice already exists

[21:54:07 Debug] 
bob already exists

[21:54:07 Information] IdentityServer4.Startup
Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e

[21:54:07 Information] IdentityServer4.Startup
You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.

[21:54:07 Debug] IdentityServer4.Startup
Custom IssuerUri set to https://localhost

[21:54:07 Information] IdentityServer4.Startup
Using the default authentication scheme Identity.Application for IdentityServer

[21:54:07 Debug] IdentityServer4.Startup
Using Identity.Application as default ASP.NET Core scheme for authentication

[21:54:07 Debug] IdentityServer4.Startup
Using Identity.External as default ASP.NET Core scheme for sign-in

[21:54:07 Debug] IdentityServer4.Startup
Using Identity.External as default ASP.NET Core scheme for sign-out

[21:54:07 Debug] IdentityServer4.Startup
Using Identity.Application as default ASP.NET Core scheme for challenge

[21:54:07 Debug] IdentityServer4.Startup
Using Identity.Application as default ASP.NET Core scheme for forbid

[21:54:07 Warning] Microsoft.AspNetCore.Server.Kestrel
Overriding address(es) 'https://localhost:5001, http://localhost:5000'. Binding to endpoints defined in UseKestrel() instead.

[21:54:07 Information] Microsoft.Hosting.Lifetime
Now listening on: http://0.0.0.0:5006

[21:54:07 Information] Microsoft.Hosting.Lifetime
Now listening on: https://0.0.0.0:5007

[21:54:07 Information] Microsoft.Hosting.Lifetime
Application started. Press Ctrl+C to shut down.

[21:54:07 Information] Microsoft.Hosting.Lifetime
Hosting environment: Development

[21:54:07 Information] Microsoft.Hosting.Lifetime
Content root path: /app

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.1 GET http://idp:5006/.well-known/openid-configuration - -

[21:57:26 Debug] IdentityServer4.Startup
Login Url: /Account/Login

[21:57:26 Debug] IdentityServer4.Startup
Login Return Url Parameter: ReturnUrl

[21:57:26 Debug] IdentityServer4.Startup
Logout Url: /Account/Logout

[21:57:26 Debug] IdentityServer4.Startup
ConsentUrl Url: /consent

[21:57:26 Debug] IdentityServer4.Startup
Consent Return Url Parameter: returnUrl

[21:57:26 Debug] IdentityServer4.Startup
Error Url: /home/error

[21:57:26 Debug] IdentityServer4.Startup
Error Id Parameter: errorId

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /.well-known/openid-configuration matched to endpoint type Discovery

[21:57:26 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint

[21:57:26 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration

[21:57:26 Debug] IdentityServer4.Endpoints.DiscoveryEndpoint
Start discovery request

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.1 GET http://idp:5006/.well-known/openid-configuration - - - 200 - application/json;+charset=UTF-8 127.0097ms

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.1 GET http://idp:5006/.well-known/openid-configuration/jwks - -

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery

[21:57:26 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint

[21:57:26 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks

[21:57:26 Debug] IdentityServer4.Endpoints.DiscoveryKeyEndpoint
Start key discovery request

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.1 GET http://idp:5006/.well-known/openid-configuration/jwks - - - 200 - application/json;+charset=UTF-8 30.9061ms

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 GET https://localhost/connect/authorize?client_id=Starter.Bff&redirect_uri=https%3A%2F%2Flocalhost%2Fsignin-oidc&response_type=code&scope=openid%20profile%20Starter.Api%20offline_access&code_challenge=E-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds&code_challenge_method=S256&response_mode=form_post&nonce=637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk&state=CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM&x-client-SKU=ID_NETSTANDARD2_0&x-client-ver=6.7.1.0 - -

[21:57:26 Information] Microsoft.AspNetCore.Cors.Infrastructure.CorsService
CORS policy execution successful.

[21:57:26 Information] Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware
No CORS policy found for the specified request.

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /connect/authorize matched to endpoint type Authorize

[21:57:26 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint

[21:57:26 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize

[21:57:26 Debug] IdentityServer4.Endpoints.AuthorizeEndpoint
Start authorize request

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] IdentityServer4.Endpoints.AuthorizeEndpoint
No user present in authorize request

[21:57:26 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Start authorize request protocol validation

[21:57:26 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:26 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Checking for PKCE parameters

[21:57:26 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator

[21:57:26 Debug] IdentityServer4.Endpoints.AuthorizeEndpoint
ValidatedAuthorizeRequest
{"ClientId":"Starter.Bff","ClientName":null,"RedirectUri":"https://localhost/signin-oidc","AllowedRedirectUris":["https://localhost/signin-oidc","https://bff:5005/signin-oidc","https://localhost/loggedin"],"SubjectId":"anonymous","ResponseType":"code","ResponseMode":"form_post","GrantType":"authorization_code","RequestedScopes":"openid profile Starter.Api offline_access","State":"CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM","UiLocales":null,"Nonce":"637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"","Raw":{"client_id":"Starter.Bff","redirect_uri":"https://localhost/signin-oidc","response_type":"code","scope":"openid profile Starter.Api offline_access","code_challenge":"E-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds","code_challenge_method":"S256","response_mode":"form_post","nonce":"637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk","state":"CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"6.7.1.0"},"$type":"AuthorizeRequestValidationLog"}

[21:57:26 Information] IdentityServer4.ResponseHandling.AuthorizeInteractionResponseGenerator
Showing login: User is not authenticated

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 GET https://localhost/connect/authorize?client_id=Starter.Bff&redirect_uri=https%3A%2F%2Flocalhost%2Fsignin-oidc&response_type=code&scope=openid%20profile%20Starter.Api%20offline_access&code_challenge=E-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds&code_challenge_method=S256&response_mode=form_post&nonce=637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk&state=CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM&x-client-SKU=ID_NETSTANDARD2_0&x-client-ver=6.7.1.0 - - - 302 0 - 89.0998ms

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 GET https://localhost/Account/Login?ReturnUrl=%2Fconnect%2Fauthorize%2Fcallback%3Fclient_id%3DStarter.Bff%26redirect_uri%3Dhttps%253A%252F%252Flocalhost%252Fsignin-oidc%26response_type%3Dcode%26scope%3Dopenid%2520profile%2520Starter.Api%2520offline_access%26code_challenge%3DE-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds%26code_challenge_method%3DS256%26response_mode%3Dform_post%26nonce%3D637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk%26state%3DCfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM%26x-client-SKU%3DID_NETSTANDARD2_0%26x-client-ver%3D6.7.1.0 - -

[21:57:26 Information] Microsoft.AspNetCore.Cors.Infrastructure.CorsService
CORS policy execution successful.

[21:57:26 Information] Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware
No CORS policy found for the specified request.

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Information] Microsoft.AspNetCore.Routing.EndpointMiddleware
Executing endpoint 'Starter.Idp.Controllers.Account.AccountController.Login (IDP)'

[21:57:26 Information] Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker
Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(System.String) on controller Starter.Idp.Controllers.Account.AccountController (IDP).

[21:57:26 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:26 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Start authorize request protocol validation

[21:57:26 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:26 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Checking for PKCE parameters

[21:57:26 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator

[21:57:26 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:26 Information] Microsoft.AspNetCore.Mvc.ViewFeatures.ViewResultExecutor
Executing ViewResult, running view Login.

[21:57:26 Information] Microsoft.AspNetCore.Mvc.ViewFeatures.ViewResultExecutor
Executed ViewResult - view Login executed in 86.6166ms.

[21:57:26 Information] Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker
Executed action Starter.Idp.Controllers.Account.AccountController.Login (IDP) in 116.2249ms

[21:57:26 Information] Microsoft.AspNetCore.Routing.EndpointMiddleware
Executed endpoint 'Starter.Idp.Controllers.Account.AccountController.Login (IDP)'

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 GET https://localhost/Account/Login?ReturnUrl=%2Fconnect%2Fauthorize%2Fcallback%3Fclient_id%3DStarter.Bff%26redirect_uri%3Dhttps%253A%252F%252Flocalhost%252Fsignin-oidc%26response_type%3Dcode%26scope%3Dopenid%2520profile%2520Starter.Api%2520offline_access%26code_challenge%3DE-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds%26code_challenge_method%3DS256%26response_mode%3Dform_post%26nonce%3D637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk%26state%3DCfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM%26x-client-SKU%3DID_NETSTANDARD2_0%26x-client-ver%3D6.7.1.0 - - - 200 - text/html;+charset=utf-8 142.2293ms

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 GET https://localhost/lib/jquery/dist/jquery.slim.min.js - -

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 GET https://localhost/lib/bootstrap/dist/css/bootstrap.min.css - -

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 GET https://localhost/css/site.css - -

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 GET https://localhost/lib/bootstrap/dist/js/bootstrap.bundle.min.js - -

[21:57:26 Information] Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware
Sending file. Request path: '/css/site.css'. Physical path: '/app/wwwroot/css/site.css'

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 GET https://localhost/css/site.css - - - 200 497 text/css 35.1366ms

[21:57:26 Information] Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware
Sending file. Request path: '/lib/jquery/dist/jquery.slim.min.js'. Physical path: '/app/wwwroot/lib/jquery/dist/jquery.slim.min.js'

[21:57:26 Information] Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware
Sending file. Request path: '/lib/bootstrap/dist/js/bootstrap.bundle.min.js'. Physical path: '/app/wwwroot/lib/bootstrap/dist/js/bootstrap.bundle.min.js'

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 GET https://localhost/lib/jquery/dist/jquery.slim.min.js - - - 200 72397 application/javascript 45.8513ms

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 GET https://localhost/lib/bootstrap/dist/js/bootstrap.bundle.min.js - - - 200 80698 application/javascript 40.7728ms

[21:57:26 Information] Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware
Sending file. Request path: '/lib/bootstrap/dist/css/bootstrap.min.css'. Physical path: '/app/wwwroot/lib/bootstrap/dist/css/bootstrap.min.css'

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 GET https://localhost/lib/bootstrap/dist/css/bootstrap.min.css - - - 200 159515 text/css 49.9157ms

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 GET https://localhost/favicon.ico - -

[21:57:26 Information] Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware
Sending file. Request path: '/favicon.ico'. Physical path: '/app/wwwroot/favicon.ico'

[21:57:26 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 GET https://localhost/favicon.ico - - - 200 1150 image/x-icon 8.0776ms

[21:57:47 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 POST https://localhost/Account/Login?ReturnUrl=%2Fconnect%2Fauthorize%2Fcallback%3Fclient_id%3DStarter.Bff%26redirect_uri%3Dhttps%253A%252F%252Flocalhost%252Fsignin-oidc%26response_type%3Dcode%26scope%3Dopenid%2520profile%2520Starter.Api%2520offline_access%26code_challenge%3DE-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds%26code_challenge_method%3DS256%26response_mode%3Dform_post%26nonce%3D637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk%26state%3DCfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM%26x-client-SKU%3DID_NETSTANDARD2_0%26x-client-ver%3D6.7.1.0 application/x-www-form-urlencoded 1198

[21:57:47 Information] Microsoft.AspNetCore.Cors.Infrastructure.CorsService
CORS policy execution successful.

[21:57:47 Information] Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware
No CORS policy found for the specified request.

[21:57:47 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:47 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:47 Information] Microsoft.AspNetCore.Routing.EndpointMiddleware
Executing endpoint 'Starter.Idp.Controllers.Account.AccountController.Login (IDP)'

[21:57:47 Information] Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker
Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(Starter.Idp.Models.Account.LoginInputModel, System.String) on controller Starter.Idp.Controllers.Account.AccountController (IDP).

[21:57:47 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:47 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Start authorize request protocol validation

[21:57:47 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:47 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Checking for PKCE parameters

[21:57:47 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator

[21:57:47 Information] Microsoft.EntityFrameworkCore.Infrastructure
Entity Framework Core 5.0.8 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None

[21:57:47 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (1ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedUserName] = @__normalizedUserName_0

[21:57:47 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (10ms) [Parameters=[@__user_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [a].[Id], [a].[ClaimType], [a].[ClaimValue], [a].[UserId]
FROM [AspNetUserClaims] AS [a]
WHERE [a].[UserId] = @__user_Id_0

[21:57:47 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0

[21:57:47 Debug] IdentityServer4.Hosting.IdentityServerAuthenticationService
Augmenting SignInContext

[21:57:47 Debug] IdentityServer4.Hosting.IdentityServerAuthenticationService
Adding idp claim with value: local

[21:57:47 Debug] IdentityServer4.Hosting.IdentityServerAuthenticationService
Adding auth_time claim with value: 1657576667

[21:57:47 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:47 Information] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application signed in.

[21:57:47 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (5ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedUserName] = @__normalizedUserName_0

[21:57:47 Information] IdentityServer4.Events.DefaultEventService
{"Username":"bob","Provider":null,"ProviderUserId":null,"SubjectId":"4","DisplayName":"bob","Endpoint":"UI","ClientId":"Starter.Bff","Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HMJ3H1BO7N74:00000002","TimeStamp":"2022-07-11T21:57:47.0000000Z","ProcessId":188,"LocalIpAddress":"172.25.0.4:5007","RemoteIpAddress":"172.25.0.1","$type":"UserLoginSuccessEvent"}

[21:57:47 Information] Microsoft.AspNetCore.Mvc.Infrastructure.RedirectResultExecutor
Executing RedirectResult, redirecting to /connect/authorize/callback?client_id=Starter.Bff&redirect_uri=https%3A%2F%2Flocalhost%2Fsignin-oidc&response_type=code&scope=openid%20profile%20Starter.Api%20offline_access&code_challenge=E-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds&code_challenge_method=S256&response_mode=form_post&nonce=637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk&state=CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM&x-client-SKU=ID_NETSTANDARD2_0&x-client-ver=6.7.1.0.

[21:57:47 Information] Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker
Executed action Starter.Idp.Controllers.Account.AccountController.Login (IDP) in 190.6803ms

[21:57:47 Information] Microsoft.AspNetCore.Routing.EndpointMiddleware
Executed endpoint 'Starter.Idp.Controllers.Account.AccountController.Login (IDP)'

[21:57:47 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 POST https://localhost/Account/Login?ReturnUrl=%2Fconnect%2Fauthorize%2Fcallback%3Fclient_id%3DStarter.Bff%26redirect_uri%3Dhttps%253A%252F%252Flocalhost%252Fsignin-oidc%26response_type%3Dcode%26scope%3Dopenid%2520profile%2520Starter.Api%2520offline_access%26code_challenge%3DE-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds%26code_challenge_method%3DS256%26response_mode%3Dform_post%26nonce%3D637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk%26state%3DCfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM%26x-client-SKU%3DID_NETSTANDARD2_0%26x-client-ver%3D6.7.1.0 application/x-www-form-urlencoded 1198 - 302 0 - 237.1264ms

[21:57:47 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.0 GET https://localhost/connect/authorize/callback?client_id=Starter.Bff&redirect_uri=https%3A%2F%2Flocalhost%2Fsignin-oidc&response_type=code&scope=openid%20profile%20Starter.Api%20offline_access&code_challenge=E-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds&code_challenge_method=S256&response_mode=form_post&nonce=637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk&state=CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM&x-client-SKU=ID_NETSTANDARD2_0&x-client-ver=6.7.1.0 - -

[21:57:47 Information] Microsoft.AspNetCore.Cors.Infrastructure.CorsService
CORS policy execution successful.

[21:57:47 Information] Microsoft.AspNetCore.Cors.Infrastructure.CorsMiddleware
No CORS policy found for the specified request.

[21:57:47 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was successfully authenticated.

[21:57:47 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was successfully authenticated.

[21:57:47 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /connect/authorize/callback matched to endpoint type Authorize

[21:57:47 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint

[21:57:47 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback

[21:57:47 Debug] IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
Start authorize callback request

[21:57:47 Debug] IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
User in authorize request: 4

[21:57:47 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Start authorize request protocol validation

[21:57:47 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:47 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Checking for PKCE parameters

[21:57:47 Debug] IdentityServer4.Validation.AuthorizeRequestValidator
Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator

[21:57:47 Debug] IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
ValidatedAuthorizeRequest
{"ClientId":"Starter.Bff","ClientName":null,"RedirectUri":"https://localhost/signin-oidc","AllowedRedirectUris":["https://localhost/signin-oidc","https://bff:5005/signin-oidc","https://localhost/loggedin"],"SubjectId":"4","ResponseType":"code","ResponseMode":"form_post","GrantType":"authorization_code","RequestedScopes":"openid profile Starter.Api offline_access","State":"CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM","UiLocales":null,"Nonce":"637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"41D5B8EE24528603A0004591D2E3AA06","Raw":{"client_id":"Starter.Bff","redirect_uri":"https://localhost/signin-oidc","response_type":"code","scope":"openid profile Starter.Api offline_access","code_challenge":"E-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds","code_challenge_method":"S256","response_mode":"form_post","nonce":"637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk","state":"CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"6.7.1.0"},"$type":"AuthorizeRequestValidationLog"}

[21:57:47 Information] Microsoft.EntityFrameworkCore.Infrastructure
Entity Framework Core 5.0.8 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None

[21:57:47 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0

[21:57:47 Debug] IdentityServer4.Services.DefaultConsentService
Client is configured to not require consent, no consent is required

[21:57:47 Debug] IdentityServer4.ResponseHandling.AuthorizeResponseGenerator
Creating Authorization Code Flow response.

[21:57:47 Information] IdentityServer4.Events.DefaultEventService
{"ClientId":"Starter.Bff","ClientName":null,"RedirectUri":"https://localhost/signin-oidc","Endpoint":"Authorize","SubjectId":"4","Scopes":"openid profile Starter.Api offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"code","TokenValue":"****9FCD","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMJ3H1BO7N75:00000002","TimeStamp":"2022-07-11T21:57:47.0000000Z","ProcessId":188,"LocalIpAddress":"172.25.0.4:5007","RemoteIpAddress":"172.25.0.1","$type":"TokenIssuedSuccessEvent"}

[21:57:47 Debug] IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
Authorize endpoint response
{"SubjectId":"4","ClientId":"Starter.Bff","RedirectUri":"https://localhost/signin-oidc","State":"CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM","Scope":"openid profile Starter.Api offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}

[21:57:47 Debug] IdentityServer4.Hosting.IdentityServerAuthenticationService
Augmenting SignInContext

[21:57:47 Information] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application signed in.

[21:57:47 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.0 GET https://localhost/connect/authorize/callback?client_id=Starter.Bff&redirect_uri=https%3A%2F%2Flocalhost%2Fsignin-oidc&response_type=code&scope=openid%20profile%20Starter.Api%20offline_access&code_challenge=E-HiAREcm_iy750dE0NEQTIyF-j5TPqv1mEzFmqZ4ds&code_challenge_method=S256&response_mode=form_post&nonce=637931734464604831.NjRmMjY5NTgtNWFjZC00OGZlLTg4MTctZjc4ZDliMmY0NjE2N2QwNjQ0YjEtNzI2NS00MmI0LTk4NGQtNTY4ZTJlMzAzMDlk&state=CfDJ8MUrgzr79AxBsdrUXJfWKk8PAzsZ_0Ddbrg7AGI-l2EcCbkQedas212mKzW5OMEgZEZzjkT4-1DFYYNjKQwuN_FIUyDztGUUXHeGigwrjCNz-3buiH7LYrPUHDLpszPWooKJh9M2DrKBXSKwocC5otCREV4b1GksfuKm070SvucRDQ7P1-PAbIyJSokRJoY8u7-0VV7DkrWEUSOtq2Wek7b4XJLDTvbo1w6I-JF84I-in76ta2bjWPCGGtta9k4AscQd9ehSf8IjRZGaW6NGAfDyudW5hFFmkxKYnUeldADb-ardW3gpLSsBxU7NxghGJOvSNUFKdha7egrWXDpl2QAc2OMY0Edu1w01Rj9XxuXSlbJKeEHv5tp4HwV5aW29L3ZvQIdg86Xz6-_8TM-UZcM&x-client-SKU=ID_NETSTANDARD2_0&x-client-ver=6.7.1.0 - - - 200 - text/html;+charset=UTF-8 110.5735ms

[21:57:48 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.1 POST http://idp:5006/connect/token application/x-www-form-urlencoded 251

[21:57:48 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:48 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:48 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /connect/token matched to endpoint type Token

[21:57:48 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint

[21:57:48 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token

[21:57:48 Debug] IdentityServer4.Endpoints.TokenEndpoint
Start token request.

[21:57:48 Debug] IdentityServer4.Validation.ClientSecretValidator
Start client validation

[21:57:48 Debug] IdentityServer4.Validation.BasicAuthenticationSecretParser
Start parsing Basic Authentication secret

[21:57:48 Debug] IdentityServer4.Validation.PostBodySecretParser
Start parsing for secret in post body

[21:57:48 Debug] IdentityServer4.Validation.ISecretsListParser
Parser found secret: PostBodySecretParser

[21:57:48 Debug] IdentityServer4.Validation.ISecretsListParser
Secret id found: Starter.Bff

[21:57:48 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:48 Debug] IdentityServer4.Validation.ISecretsListValidator
Secret validator success: HashedSharedSecretValidator

[21:57:48 Debug] IdentityServer4.Validation.ClientSecretValidator
Client validation success

[21:57:48 Information] IdentityServer4.Events.DefaultEventService
{"ClientId":"Starter.Bff","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HMJ3H1BO7N6S:00000004","TimeStamp":"2022-07-11T21:57:48.0000000Z","ProcessId":188,"LocalIpAddress":"172.25.0.4:5006","RemoteIpAddress":"172.25.0.5","$type":"ClientAuthenticationSuccessEvent"}

[21:57:48 Debug] IdentityServer4.Validation.TokenRequestValidator
Start token request validation

[21:57:48 Debug] IdentityServer4.Validation.TokenRequestValidator
Start validation of authorization code token request

[21:57:48 Debug] IdentityServer4.Validation.TokenRequestValidator
Client required a proof key for code exchange. Starting PKCE validation

[21:57:48 Information] Microsoft.EntityFrameworkCore.Infrastructure
Entity Framework Core 5.0.8 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None

[21:57:48 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0

[21:57:48 Debug] IdentityServer4.Validation.TokenRequestValidator
Validation of authorization code token request success

[21:57:48 Information] IdentityServer4.Validation.TokenRequestValidator
Token request validation success, {"ClientId":"Starter.Bff","ClientName":null,"GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"****9FCD","RefreshToken":"********","UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"Starter.Bff","client_secret":"***REDACTED***","code":"6B456B61C49FE6F80C270F073144A6F3CADC8B7FB661F87F3B22585F6A259FCD","grant_type":"authorization_code","redirect_uri":"https://localhost/signin-oidc","code_verifier":"5wafj5hGSMvY7GpXW2g6DVvowCsNbnFw8WDNfCvlxSc"},"$type":"TokenRequestValidationLog"}

[21:57:48 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:48 Debug] IdentityServer4.Services.DefaultClaimsService
Getting claims for access token for client: Starter.Bff

[21:57:48 Debug] IdentityServer4.Services.DefaultClaimsService
Getting claims for access token for subject: 4

[21:57:48 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [a].[Id], [a].[ClaimType], [a].[ClaimValue], [a].[UserId]
FROM [AspNetUserClaims] AS [a]
WHERE [a].[UserId] = @__user_Id_0

[21:57:48 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0

[21:57:48 Debug] IdentityServer4.Services.DefaultRefreshTokenService
Creating refresh token

[21:57:48 Debug] IdentityServer4.Services.DefaultRefreshTokenService
Setting an absolute lifetime: 2592000

[21:57:48 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:48 Debug] IdentityServer4.Services.DefaultClaimsService
Getting claims for identity token for subject: 4 and client: Starter.Bff

[21:57:48 Debug] IdentityServer4.Services.DefaultClaimsService
In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.

[21:57:48 Information] IdentityServer4.Events.DefaultEventService
{"ClientId":"Starter.Bff","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":"4","Scopes":"openid profile Starter.Api offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****IJhg","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****16BE","$type":"Token"},{"TokenType":"access_token","TokenValue":"****pGtA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMJ3H1BO7N6S:00000004","TimeStamp":"2022-07-11T21:57:48.0000000Z","ProcessId":188,"LocalIpAddress":"172.25.0.4:5006","RemoteIpAddress":"172.25.0.5","$type":"TokenIssuedSuccessEvent"}

[21:57:48 Debug] IdentityServer4.Endpoints.TokenEndpoint
Token request success.

[21:57:48 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.1 POST http://idp:5006/connect/token application/x-www-form-urlencoded 251 - 200 - application/json;+charset=UTF-8 170.9066ms

[21:57:48 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.1 GET http://idp:5006/connect/userinfo - -

[21:57:48 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:48 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:48 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /connect/userinfo matched to endpoint type Userinfo

[21:57:48 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint

[21:57:48 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo

[21:57:48 Debug] IdentityServer4.Endpoints.UserInfoEndpoint
Start userinfo request

[21:57:48 Debug] IdentityServer4.Validation.BearerTokenUsageValidator
Bearer token found in header

[21:57:48 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:48 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:48 Information] Microsoft.EntityFrameworkCore.Infrastructure
Entity Framework Core 5.0.8 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None

[21:57:48 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0

[21:57:48 Debug] IdentityServer4.Validation.TokenValidator
Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator

[21:57:48 Debug] IdentityServer4.Validation.TokenValidator
Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"7E6D16A166E59E9D702D0B0AA06B8812","Claims":{"nbf":1657576668,"exp":1657580268,"iss":"https://localhost","aud":["starter.api","https://localhost/resources"],"client_id":"Starter.Bff","sub":"4","auth_time":1657576667,"idp":"local","jti":"7E6D16A166E59E9D702D0B0AA06B8812","sid":"41D5B8EE24528603A0004591D2E3AA06","iat":1657576668,"scope":["openid","profile","Starter.Api","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}

[21:57:48 Debug] IdentityServer4.ResponseHandling.UserInfoResponseGenerator
Creating userinfo response

[21:57:48 Debug] IdentityServer4.ResponseHandling.UserInfoResponseGenerator
Scopes in access token: openid profile Starter.Api offline_access

[21:57:48 Debug] IdentityServer4.ResponseHandling.UserInfoResponseGenerator
Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at

[21:57:48 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [a].[Id], [a].[ClaimType], [a].[ClaimValue], [a].[UserId]
FROM [AspNetUserClaims] AS [a]
WHERE [a].[UserId] = @__user_Id_0

[21:57:48 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0

[21:57:48 Information] IdentityServer4.ResponseHandling.UserInfoResponseGenerator
Profile service returned the following claim types: sub website family_name given_name name preferred_username

[21:57:48 Debug] IdentityServer4.Endpoints.UserInfoEndpoint
End userinfo request

[21:57:48 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.1 GET http://idp:5006/connect/userinfo - - - 200 - application/json;+charset=UTF-8 111.9938ms

[21:57:49 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.1 GET http://idp:5006/.well-known/openid-configuration - -

[21:57:49 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:49 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:49 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /.well-known/openid-configuration matched to endpoint type Discovery

[21:57:49 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint

[21:57:49 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration

[21:57:49 Debug] IdentityServer4.Endpoints.DiscoveryEndpoint
Start discovery request

[21:57:49 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.1 GET http://idp:5006/.well-known/openid-configuration - - - 200 - application/json;+charset=UTF-8 8.8974ms

[21:57:49 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.1 GET http://idp:5006/.well-known/openid-configuration/jwks - -

[21:57:49 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:49 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:49 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery

[21:57:49 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint

[21:57:49 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks

[21:57:49 Debug] IdentityServer4.Endpoints.DiscoveryKeyEndpoint
Start key discovery request

[21:57:49 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.1 GET http://idp:5006/.well-known/openid-configuration/jwks - - - 200 - application/json;+charset=UTF-8 2.8552ms

[21:57:49 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request starting HTTP/1.1 GET http://idp:5006/connect/userinfo - -

[21:57:49 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:49 Debug] Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler
AuthenticationScheme: Identity.Application was not authenticated.

[21:57:49 Debug] IdentityServer4.Hosting.EndpointRouter
Request path /connect/userinfo matched to endpoint type Userinfo

[21:57:49 Debug] IdentityServer4.Hosting.EndpointRouter
Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint

[21:57:49 Information] IdentityServer4.Hosting.IdentityServerMiddleware
Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo

[21:57:49 Debug] IdentityServer4.Endpoints.UserInfoEndpoint
Start userinfo request

[21:57:49 Debug] IdentityServer4.Validation.BearerTokenUsageValidator
Bearer token found in header

[21:57:49 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:49 Debug] IdentityServer4.Stores.ValidatingClientStore
client configuration validation for client Starter.Bff succeeded.

[21:57:49 Information] Microsoft.EntityFrameworkCore.Infrastructure
Entity Framework Core 5.0.8 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None

[21:57:49 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0

[21:57:49 Debug] IdentityServer4.Validation.TokenValidator
Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator

[21:57:49 Debug] IdentityServer4.Validation.TokenValidator
Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"7E6D16A166E59E9D702D0B0AA06B8812","Claims":{"nbf":1657576668,"exp":1657580268,"iss":"https://localhost","aud":["starter.api","https://localhost/resources"],"client_id":"Starter.Bff","sub":"4","auth_time":1657576667,"idp":"local","jti":"7E6D16A166E59E9D702D0B0AA06B8812","sid":"41D5B8EE24528603A0004591D2E3AA06","iat":1657576668,"scope":["openid","profile","Starter.Api","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}

[21:57:49 Debug] IdentityServer4.ResponseHandling.UserInfoResponseGenerator
Creating userinfo response

[21:57:49 Debug] IdentityServer4.ResponseHandling.UserInfoResponseGenerator
Scopes in access token: openid profile Starter.Api offline_access

[21:57:49 Debug] IdentityServer4.ResponseHandling.UserInfoResponseGenerator
Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at

[21:57:49 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [a].[Id], [a].[ClaimType], [a].[ClaimValue], [a].[UserId]
FROM [AspNetUserClaims] AS [a]
WHERE [a].[UserId] = @__user_Id_0

[21:57:49 Information] Microsoft.EntityFrameworkCore.Database.Command
Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0

[21:57:49 Information] IdentityServer4.ResponseHandling.UserInfoResponseGenerator
Profile service returned the following claim types: sub website family_name given_name name preferred_username

[21:57:49 Debug] IdentityServer4.Endpoints.UserInfoEndpoint
End userinfo request

[21:57:49 Information] Microsoft.AspNetCore.Hosting.Diagnostics
Request finished HTTP/1.1 GET http://idp:5006/connect/userinfo - - - 200 - application/json;+charset=UTF-8 29.9300ms


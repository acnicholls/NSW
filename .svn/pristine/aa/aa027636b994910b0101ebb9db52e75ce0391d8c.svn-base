using System;
using System.Web;
using System.Web.Security;

namespace NSW.Account
{
    public partial class Login : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            RegisterHyperLink.NavigateUrl = "Register.aspx?ReturnUrl=" + HttpUtility.UrlEncode(Request.QueryString["ReturnUrl"]);
            LoadLabelValues();
        }

        protected void LoginButton_Click(object sender, EventArgs e)
        {
            NSW.Data.Security.MembershipProvider mp = new Data.Security.MembershipProvider();
            if (mp.ValidateUser(this.LoginUser.UserName, this.LoginUser.Password))
            {
                FormsAuthentication.SetAuthCookie(LoginUser.UserName, LoginUser.RememberMeSet);
                string url = "~/Default.aspx";
                if (Request.QueryString["ReturnUrl"] != null)
                    url = Request.QueryString["ReturnUrl"].ToString();
                Response.Redirect(url);
            }

        }

        private void LoadLabelValues()
        {
            // now pass the proper values to the page objects
            this.LoginPageTitle.Text = NSW.Data.LabelText.Text("LoginPageTitle");
            this.LoginPageInstructions.Text = NSW.Data.LabelText.Text("LoginPageInst");
            this.RegisterHyperLink.Text = NSW.Data.LabelText.Text("LoginHyperLink");
            this.RegisterInstructions.Text = NSW.Data.LabelText.Text("RegisterInst");
            this.LoginUser.UserNameLabelText = NSW.Data.LabelText.Text("UserNameLabel");
            this.LoginUser.PasswordLabelText = NSW.Data.LabelText.Text("PasswordLabel");
            this.LoginUser.PasswordRequiredErrorMessage = NSW.Data.LabelText.Text("PassRequired");
            this.LoginUser.UserNameRequiredErrorMessage = NSW.Data.LabelText.Text("UserRequired");
            this.LoginUser.RememberMeText = NSW.Data.LabelText.Text("RememberMe");
            this.LoginUser.LoginButtonText = NSW.Data.LabelText.Text("btnLogin");
            this.LoginUser.FailureText = NSW.Data.LabelText.Text("LoginFailMsg");
        }
    }
}

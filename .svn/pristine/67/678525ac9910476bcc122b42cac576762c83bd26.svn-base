using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.IO;

namespace NSW.Posts
{
    public partial class ViewPost : System.Web.UI.Page
    {
        NSW.Data.Post thisPost;
        NSW.Data.User thisUser;
        NSW.Data.PostalCode userPC;
        string pFolder = "~/Posts/Photos/";

        protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                int itemID = Convert.ToInt32(Request.QueryString["postID"]);
                LoadItemInfo(itemID);
                LoadLabelValues();
                LoadItemPics(itemID);
            }

        }

        protected void vpItemThumb1_Click(object sender, ImageClickEventArgs e)
        {
            FileInfo[] picList = (FileInfo[])NSW.Data.Cache.Get("ItemPics");
            thisPost = (NSW.Data.Post)NSW.Data.Cache.Get("Post");
            this.vpItemPic.ImageUrl = pFolder + thisPost.ID.ToString() + "/" + picList[0].Name;
        }

        protected void vpItemThumb2_Click(object sender, ImageClickEventArgs e)
        {
            FileInfo[] picList = (FileInfo[])NSW.Data.Cache.Get("ItemPics");
            thisPost = (NSW.Data.Post)NSW.Data.Cache.Get("Post");
            this.vpItemPic.ImageUrl = pFolder + thisPost.ID.ToString() + "/" + picList[1].Name;
        }

        protected void vpItemThumb3_Click(object sender, ImageClickEventArgs e)
        {
            FileInfo[] picList = (FileInfo[])NSW.Data.Cache.Get("ItemPics");
            thisPost = (NSW.Data.Post)NSW.Data.Cache.Get("Post");
            this.vpItemPic.ImageUrl = pFolder + thisPost.ID.ToString() + "/" + picList[2].Name;
        }

        protected void vpItemThumb4_Click(object sender, ImageClickEventArgs e)
        {
            FileInfo[] picList = (FileInfo[])NSW.Data.Cache.Get("ItemPics");
            thisPost = (NSW.Data.Post)NSW.Data.Cache.Get("Post");
            this.vpItemPic.ImageUrl = pFolder + thisPost.ID.ToString() + "/" + picList[3].Name;
        }

        protected void vpUserContact_Click(object sender, EventArgs e)
        {

        }

        protected void vpUserItems_Click(object sender, EventArgs e)
        {

        }

        private void LoadItemInfo(int itemID)
        {
            thisPost = new Data.Post(itemID);
            NSW.Data.Cache.Add("Post", thisPost);
            thisUser = new Data.User(thisPost.UserID);
            userPC = new Data.PostalCode(thisUser.PostalCode);
        }

        private void LoadLabelValues()
        {
            this.vpDescription.Text = thisPost.Description;
            this.vpItemPrice.Text = thisPost.Price.ToString("C");
            this.vpItemTitle.Text = thisPost.Title;
        }

        private void LoadItemPics(int itemID)
        {
            string Folder = pFolder + itemID.ToString();
            DirectoryInfo picFolder = new DirectoryInfo(Server.MapPath(Folder));
            if (picFolder.Exists)
            {
                FileInfo[] pics = picFolder.GetFiles();
                switch (pics.Length)
                {
                    case 1:
                        {
                            this.vpItemThumb1.ImageUrl = Folder + "/" + pics[0].Name;
                            this.vpItemThumb2.Visible = false;
                            this.vpItemThumb3.Visible = false;
                            this.vpItemThumb4.Visible = false;
                            break;
                        }
                    case 2:
                        {
                            this.vpItemThumb1.ImageUrl = Folder + "/" + pics[0].Name;
                            this.vpItemThumb2.ImageUrl = Folder + "/" + pics[1].Name;
                            this.vpItemThumb3.Visible = false;
                            this.vpItemThumb4.Visible = false;
                            break;
                        }
                    case 3:
                        {
                            this.vpItemThumb1.ImageUrl = Folder + "/" + pics[0].Name;
                            this.vpItemThumb2.ImageUrl = Folder + "/" + pics[1].Name;
                            this.vpItemThumb3.ImageUrl = Folder + "/" + pics[2].Name;
                            this.vpItemThumb4.Visible = false;
                            break;
                        }
                    case 4:
                        {
                            this.vpItemThumb1.ImageUrl = Folder + "/" + pics[0].Name;
                            this.vpItemThumb2.ImageUrl = Folder + "/" + pics[1].Name;
                            this.vpItemThumb3.ImageUrl = Folder + "/" + pics[2].Name;
                            this.vpItemThumb4.ImageUrl = Folder + "/" + pics[3].Name;
                            break;
                        }
                }
                this.vpItemPic.ImageUrl = Folder + "/" + pics[0].Name;
                NSW.Data.Cache.Add("ItemPics", pics);
            }
            else
            {
                this.vpItemPic.Visible = false;
                this.vpItemThumb1.Visible = false;
                this.vpItemThumb2.Visible = false;
                this.vpItemThumb3.Visible = false;
                this.vpItemThumb4.Visible = false;
            }
        }
    }
}
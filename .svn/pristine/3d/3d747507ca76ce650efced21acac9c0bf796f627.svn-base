using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data;
using System.Data.SqlClient;

namespace NSW.Admin
{
    public partial class LabelText : System.Web.UI.Page
    {
        SqlConnection labelConn = new SqlConnection(NSW.Info.ConnectionInfo.ConnectionString);
        SqlCommand labelComm;

        protected void Page_Load(object sender, EventArgs e)
        {
            Log.WriteToLog(NSW.Info.ProjectInfo.ProjectLogType, "LabelText.FinishClick", "Here", LogEnum.Debug);
            try
            {
                if (!IsPostBack)
                {
                    // load the dropdown values
                    labelComm = labelConn.CreateCommand();
                    labelComm.CommandType = CommandType.Text;
                    labelComm.CommandText = "Select fldLabel_ID from tblLabelText";
                    DataSet ds = new DataSet();
                    SqlDataAdapter adap = new SqlDataAdapter(labelComm);
                    labelConn.Open();
                    adap.Fill(ds);
                    labelConn.Close();
                    ddlLabelID.Items.Add("Select One...");
                    foreach (DataRow dr in ds.Tables[0].Rows)
                    {
                        ddlLabelID.Items.Add(dr["fldLabel_ID"].ToString());
                    }
                    Cache["LabelIDList"] = ds;
                }
                LoadLabelValues();
            }
            catch (Exception x)
            {
                Log.WriteToLog(NSW.Info.ProjectInfo.ProjectLogType, "LabelText.Page_Load", x, LogEnum.Critical);
            }
        }

        protected void FinishClick(object sender, WizardNavigationEventArgs e)
        {
            Log.WriteToLog(NSW.Info.ProjectInfo.ProjectLogType, "LabelText.FinishClick", "Here", LogEnum.Debug);
            try
            {
                // check and save the values
                labelComm = labelConn.CreateCommand();
                labelComm.CommandType = CommandType.StoredProcedure;
                labelComm.CommandText = "modifyLabelText";
                SqlParameter param = new SqlParameter("@ID", this.ddlLabelID.SelectedItem.Text.ToString());
                labelComm.Parameters.Add(param);
                param = new SqlParameter("@english", this.txtEnglish.Text.ToString());
                labelComm.Parameters.Add(param);
                param = new SqlParameter("@japanese", this.txtJapanese.Text.ToString());
                labelComm.Parameters.Add(param);
                labelConn.Open();
                int result = labelComm.ExecuteNonQuery();
                labelConn.Close();
            }
            catch (Exception x)
            {
                Log.WriteToLog(NSW.Info.ProjectInfo.ProjectLogType, "LabelText.FinishClick", x, LogEnum.Critical);
            }
        }

        protected void CancelClick(object sender, EventArgs e)
        {
            // clear the form and return the user to the main webform
            string url = "~/Default.aspx";
            Response.Redirect(url);
        }

        protected void ddlLabelID_SelectedIndexChanged(object sender, EventArgs e)
        {
            try
            {
                // change the values of the form
                labelComm = labelConn.CreateCommand();
                labelComm.CommandType = CommandType.Text;
                labelComm.CommandText = "Select * from tblLabelText"; // where fldLabel_ID='" + ddlLabelID.SelectedItem.Text.ToString() + "'";
                DataSet ds = new DataSet();
                SqlDataAdapter adap = new SqlDataAdapter(labelComm);
                labelConn.Open();
                adap.Fill(ds);
                labelConn.Close();
                DataRow[] dr = ds.Tables[0].Select("fldLabel_ID='" + ddlLabelID.SelectedItem.Text.ToString() + "'");
                if (dr.Length == 1)
                {
                    string eng = dr[0]["fldLabel_English"].ToString();
                    string jap = dr[0]["fldLabel_Japanese"].ToString();
                    this.txtEnglish.Text = eng;
                    this.txtJapanese.Text = jap;
                }
                else
                {
                    LabelTextErrorMessage.Text = "Please choose a valid label from the list.";
                }
            }
            catch (Exception x)
            {
                Log.WriteToLog(NSW.Info.ProjectInfo.ProjectLogType, "LabelText.ddlLabelID_SelectedIndexChanged", x, LogEnum.Critical);
            }
        }

        private void LoadLabelValues()
        {
            // declare all label text objects
            NSW.Data.LabelText id = new Data.LabelText("lbl_ddlLabelID");
            NSW.Data.LabelText english = new Data.LabelText("lbl_txtEnglish");
            NSW.Data.LabelText japanese = new Data.LabelText("lbl_txtJapanese");
            this.lbl_ddlLabelID.Text = id.Text;
            this.lbl_txtEnglish.Text = english.Text;
            this.lbl_txtJapanese.Text = japanese.Text;
        }
    }
}